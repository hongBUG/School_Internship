<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.tentact.nebula.db.dao.I_CompanyDao">

	<!-- 查询企业记录总数 -->
	<select id="searchCount" parameterType="Map" resultType="long">
		SELECT 
			COUNT(*) AS count 
		FROM 
			company
		<where>
			<if test="name != null">
				AND name LIKE '%${name}%'
			</if>
			<if test="domain != null">
				AND domain = #{domain}
			</if>
		</where>
	</select>
	
	<!-- 查询企业信息 -->
	<select id="searchById" parameterType="int" resultType="Map">
		SELECT
			id,
			`name`,
			address,
			tel,
			domain,
			type,
			property,
			scale,
			introduction
		FROM
			company
		WHERE
			id = #{id}
	</select>
	
	<!-- 查询企业信息记录 -->
	<select id="searchList" parameterType="Map" resultType="Map">
		SELECT
			c.id,
			c.`name`,
			c.tel,
			c.domain,
			c.type,
			c.property,
			c.scale,
			IFNULL(t.count, 0) AS recruit_count
		FROM
			company c
		LEFT JOIN 
			(
				SELECT
					company_id,
					COUNT(*) AS count
				FROM
					recruit
				WHERE state = "有效"
				GROUP BY
					company_id
			) t 
		ON 
			c.id = t.company_id
		<where>
			<if test="name != null">
				AND c.name LIKE '%${name}%'
			</if>
			<if test="domain != null">
				AND c.domain = #{domain}
			</if>
		</where>
		LIMIT 
			#{start} , #{length}
	</select>
	
	<!-- 添加记录 -->
	<insert id="add" parameterType="Map">
		INSERT IGNORE INTO 
			company 
		SET
			`name` = #{name},
			address = #{address},
			tel = #{tel},
			domain = #{domain},
			type = #{type},
			property = #{property},
			scale = #{scale},
			introduction = #{introduction}
	</insert>
	
	<!-- 修改企业记录 -->
	<update id="update" parameterType="Map">
		UPDATE 
			company
		SET
			`name` = #{name},
			address = #{address},
			tel = #{tel},
			domain = #{domain},
			type = #{type},
			property = #{property},
			scale = #{scale},
			introduction = #{introduction}
		WHERE
			id = #{id}
	</update>
	
	<!-- 删除企业记录 -->
	<delete id="deleteById" parameterType="Map">
		DELETE FROM 
			company
		WHERE 
			id IN
			<foreach collection="id" item="one" open="(" close=")" separator=",">
				#{one}
			</foreach> 
	</delete>
</mapper>